<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CX Library Search</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #f7f3ff;
      --bg-alt: #ffffff;
      --accent: #7b5dd8;
      --accent-soft: #e1d8ff;
      --text: #2f2a3f;
      --muted: #6b647f;
      --border: #ddd3ff;
      --shadow: 0 4px 16px rgba(61, 44, 129, 0.12);
      --radius: 14px;
      --font-main: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    * { box-sizing: border-box; }

    /* üå∏ Corner gradient glow */
    .corner-glow {
      position: fixed;
      top: -80px;
      right: -80px;
      width: 260px;
      height: 260px;
      background: radial-gradient(
        circle at center,
        rgba(139, 92, 246, 0.28),
        rgba(255, 255, 255, 0) 70%
      );
      filter: blur(14px);
      pointer-events: none;
      z-index: 0;
    }

    body {
      margin: 0;
      padding: 24px;
      font-family: var(--font-main);
      background: radial-gradient(circle at top left, #f0e7ff 0, #fdfbff 50%, #f7f3ff 100%);
      color: var(--text);
    }

    .app {
      max-width: 960px;
      margin: 0 auto;
      background: rgba(255,255,255,0.9);
      border-radius: 24px;
      box-shadow: var(--shadow);
      padding: 24px 24px 28px;
      border: 1px solid var(--border);
      backdrop-filter: blur(6px);
      position: relative;
      z-index: 1;
    }

    .header {
      text-align: center;
      margin-bottom: 20px;
    }

    .title {
      font-size: 1.6rem;
      font-weight: 700;
      margin: 0 0 4px;
      letter-spacing: 0.02em;
    }

    .subtitle {
      margin: 0;
      font-size: 0.95rem;
      color: var(--muted);
    }

    .search-row {
      margin-top: 18px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      justify-content: center;
    }

    .search-input-wrap {
      position: relative;
      flex: 1 1 260px;
      max-width: 500px;
    }

    .search-input {
      width: 100%;
      padding: 10px 36px 10px 34px;
      border-radius: 999px;
      border: 1px solid var(--border);
      font-size: 0.95rem;
      outline: none;
      background: #fdfbff;
      color: var(--text);
      box-shadow: 0 1px 4px rgba(0,0,0,0.04) inset;
    }

    .search-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(123, 93, 216, 0.18);
    }

    .search-icon {
      position: absolute;
      left: 11px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.95rem;
      color: var(--muted);
    }

    .clear-btn {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      border: none;
      background: transparent;
      color: var(--muted);
      cursor: pointer;
      font-size: 0.9rem;
      padding: 2px 4px;
      border-radius: 999px;
    }

    .clear-btn:hover { background: rgba(0,0,0,0.04); }

    .filters {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .pill {
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 0.8rem;
      border: 1px solid var(--border);
      background: #fdfbff;
      color: var(--muted);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .pill span.count {
      background: var(--accent-soft);
      color: var(--accent);
      padding: 2px 7px;
      border-radius: 999px;
      font-size: 0.7rem;
    }

    .pill.active {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
    }

    .pill.active span.count {
      background: rgba(255,255,255,0.14);
      color: #fff;
    }

    .results-meta {
      margin: 16px 4px 8px;
      font-size: 0.8rem;
      color: var(--muted);
      text-align: left;
    }

    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 12px;
      margin-top: 8px;
    }

    .card {
      background: var(--bg-alt);
      border-radius: var(--radius);
      padding: 12px 12px 12px;
      border: 1px solid rgba(221,211,255,0.8);
      box-shadow: 0 2px 8px rgba(61, 44, 129, 0.06);
      display: flex;
      flex-direction: column;
      gap: 6px;
      transition: transform 0.08s ease-out, box-shadow 0.08s ease-out, border-color 0.08s;
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 14px rgba(61, 44, 129, 0.13);
      border-color: var(--accent-soft);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 8px;
    }

    .card-title {
      margin: 0;
      font-size: 0.95rem;
      font-weight: 600;
    }

    .badge {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      white-space: nowrap;
    }

    .card-desc {
      margin: 0;
      font-size: 0.8rem;
      color: var(--muted);
    }

    .tags {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 4px;
    }

    .tag {
      font-size: 0.7rem;
      padding: 2px 6px;
      border-radius: 999px;
      background: #f3efff;
      color: #5a4aa8;
    }

    .card-footer {
      margin-top: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .link {
      font-size: 0.8rem;
      color: var(--accent);
      text-decoration: none;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .link:hover { text-decoration: underline; }

    .file-path {
      font-size: 0.7rem;
      color: var(--muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 160px;
    }

    .empty {
      margin-top: 16px;
      text-align: center;
      font-size: 0.85rem;
      color: var(--muted);
    }

    @media (max-width: 600px) {
      .app { padding: 16px; }
      .title { font-size: 1.3rem; }
      .search-row { flex-direction: column; align-items: stretch; }
      .results-meta { text-align: center; }
      .file-path { max-width: 110px; }
    }
  </style>
</head>

<body>
  <div class="corner-glow"></div>

  <div class="app">
    <header class="header">
      <h1 class="title">CX Library Search</h1>
      <p class="subtitle">Type what you need (e.g. ‚Äúrefund‚Äù, ‚Äúoutage‚Äù, ‚Äúbilling‚Äù, ‚Äúaccessibility‚Äù) and filter by macros or processes.</p>

      <div class="search-row">
        <div class="search-input-wrap">
          <span class="search-icon">üîç</span>
          <input
            type="text"
            id="searchInput"
            class="search-input"
            placeholder="Search macros, processes, topics‚Ä¶"
            autocomplete="off"
          />
          <button class="clear-btn" id="clearBtn" title="Clear search">‚úï</button>
        </div>

        <div class="filters">
          <button class="pill active" data-filter="all">All <span class="count" id="count-all">0</span></button>
          <button class="pill" data-filter="macro">Macros <span class="count" id="count-macro">0</span></button>
          <button class="pill" data-filter="process">Processes <span class="count" id="count-process">0</span></button>
        </div>
      </div>
    </header>

    <div class="results-meta">
      <span id="resultsCount">Indexing‚Ä¶</span>
    </div>

    <section class="results-grid" id="resultsGrid"></section>

    <div class="empty" id="emptyState" style="display:none;">
      No matches found. Try a broader term like <strong>refund</strong>, <strong>billing</strong>, <strong>technical</strong>, or <strong>outage</strong>.
    </div>
  </div>

  <script>
    // Repo settings
    const OWNER = "victoriagracey";
    const REPO  = "cx-macros-library";
    const BRANCH = "main";

    /**
     * Optional enrichment map:
     * Keeps your nice titles/tags/descriptions for known files.
     * Anything not listed still appears (with auto-title + auto-tags).
     */
    const ENRICH = {
      "macros/general.md": {
        title: "General Macros",
        tags: ["general", "first response", "follow-up", "closing"],
        description: "Core macros for acknowledgements, updates, and closing conversations."
      },
      "macros/refunds-and-compensation.md": {
        title: "Refunds & Compensation Macros",
        tags: ["refund", "compensation", "goodwill", "billing"],
        description: "Ready-to-use wording for refunds, partial credits, and goodwill gestures."
      },
      "macros/technical-issues.md": {
        title: "Technical Issues Macros",
        tags: ["technical", "bug", "issue", "troubleshooting", "engineering"],
        description: "Macros for acknowledging, troubleshooting, and escalating technical problems."
      },
      "macros/membership-and-billing.md": {
        title: "Membership & Billing Macros",
        tags: ["billing", "membership", "subscription", "payments", "charges"],
        description: "Templates for billing confusion, failed payments, plan changes, and cancellations."
      },
      "macros/social-media.md": {
        title: "Social Media Response Macros",
        tags: ["social", "twitter", "facebook", "instagram", "public", "short replies"],
        description: "Short, brand-safe responses for public social media conversations."
      },
      "macros/accessibility.md": {
        title: "Accessibility-Friendly Macros",
        tags: ["accessibility", "plain language", "neurodivergent", "inclusive"],
        description: "Macros designed with accessibility, clarity, and reduced cognitive load in mind."
      },
      "macros/tone-variations.md": {
        title: "Tone Variations",
        tags: ["tone", "formal", "warm", "concise", "empathetic"],
        description: "The same message expressed in formal, warm, concise, and empathetic tones."
      },
      "macros/escalations-and-internal-notes.md": {
        title: "Escalations & Internal Notes",
        tags: ["escalation", "internal notes", "handovers", "engineering"],
        description: "Internal templates for clean case handovers and escalations to other teams."
      },

      "processes/troubleshooting-workflows.md": {
        title: "Troubleshooting Workflows",
        tags: ["troubleshooting", "workflow", "diagnosis"],
        description: "System-neutral troubleshooting flows for general issues, login, payments, apps, and web."
      },
      "processes/outage-playbook.md": {
        title: "Outage Playbook",
        tags: ["outage", "incident", "status", "communication"],
        description: "Step-by-step guide for identifying, classifying, and communicating service outages."
      },
      "processes/cancellations-process.md": {
        title: "Cancellations Process",
        tags: ["cancellation", "subscription", "churn"],
        description: "Structured workflow for handling cancellation requests and communicating clearly with customers."
      },
      "processes/refunds-process.md": {
        title: "Refunds Process",
        tags: ["refunds", "billing", "eligibility", "policy"],
        description: "System-neutral refund assessment and processing flow, including communication templates."
      },
      "processes/verification-checklist.md": {
        title: "Verification Checklist",
        tags: ["verification", "security", "identity", "compliance"],
        description: "Checklist for safely verifying customers before sharing or changing account information."
      }
    };

    // Live, auto-built list
    let items = [];

    const searchInput = document.getElementById("searchInput");
    const clearBtn = document.getElementById("clearBtn");
    const resultsGrid = document.getElementById("resultsGrid");
    const resultsCount = document.getElementById("resultsCount");
    const emptyState = document.getElementById("emptyState");
    const filterButtons = document.querySelectorAll(".pill");
    const countAll = document.getElementById("count-all");
    const countMacro = document.getElementById("count-macro");
    const countProcess = document.getElementById("count-process");

    let currentFilter = "all";

    function niceTitleFromFilename(name) {
      return name
        .replace(/\.[^/.]+$/, "")
        .replace(/[-_]+/g, " ")
        .replace(/\b\w/g, c => c.toUpperCase());
    }

    function autoTagsFromPath(path) {
      const base = path.split("/").pop().replace(/\.md$/i, "");
      const parts = base.split(/[-_]+/g).filter(Boolean);
      const stop = new Set(["and","the","a","an","of","to","for","in"]);

      const tags = parts
        .map(p => p.trim().toLowerCase())
        .filter(p => p && !stop.has(p))
        .slice(0, 8);

      // tiny helpful nudges
      if (tags.includes("refunds") && !tags.includes("refund")) tags.push("refund");
      if (tags.includes("refund") && !tags.includes("billing")) tags.push("billing");
      if (tags.includes("outage") && !tags.includes("incident")) tags.push("incident");

      return Array.from(new Set(tags));
    }

    async function fetchDir(dir, type) {
      const url = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${dir}?ref=${BRANCH}`;
      const res = await fetch(url, { headers: { "Accept": "application/vnd.github+json" } });
      if (!res.ok) throw new Error(`GitHub API failed for ${dir}: ${res.status}`);

      const data = await res.json();
      return (Array.isArray(data) ? data : [])
        .filter(f => f.type === "file" && f.name.endsWith(".md"))
        .map(f => {
          const path = `${dir}/${f.name}`;
          const enriched = ENRICH[path];

          return {
            title: enriched?.title ?? niceTitleFromFilename(f.name),
            type,
            path,
            tags: enriched?.tags ?? autoTagsFromPath(path),
            description: enriched?.description ?? ""
          };
        });
    }

    function matchesQuery(item, query) {
      if (!query) return true;
      const q = query.toLowerCase();
      return (
        item.title.toLowerCase().includes(q) ||
        (item.description || "").toLowerCase().includes(q) ||
        (item.tags || []).some(tag => tag.toLowerCase().includes(q))
      );
    }

    function passesFilter(item, filter) {
      if (filter === "all") return true;
      return item.type === filter;
    }

    function setCounts() {
      countAll.textContent = items.length;
      countMacro.textContent = items.filter(i => i.type === "macro").length;
      countProcess.textContent = items.filter(i => i.type === "process").length;
    }

    function render() {
      const query = searchInput.value.trim();
      const filtered = items.filter(
        (item) => matchesQuery(item, query) && passesFilter(item, currentFilter)
      );

      resultsGrid.innerHTML = "";
      emptyState.style.display = filtered.length === 0 ? "block" : "none";

      filtered.forEach((item) => {
        const card = document.createElement("article");
        card.className = "card";

        const header = document.createElement("div");
        header.className = "card-header";

        const title = document.createElement("h2");
        title.className = "card-title";
        title.textContent = item.title;

        const badge = document.createElement("span");
        badge.className = "badge";
        badge.textContent = item.type === "macro" ? "Macro" : "Process";

        header.appendChild(title);
        header.appendChild(badge);

        const desc = document.createElement("p");
        desc.className = "card-desc";
        desc.textContent = item.description || "";

        const tagWrap = document.createElement("div");
        tagWrap.className = "tags";
        (item.tags || []).forEach((t) => {
          const tag = document.createElement("span");
          tag.className = "tag";
          tag.textContent = t;
          tagWrap.appendChild(tag);
        });

        const footer = document.createElement("div");
        footer.className = "card-footer";

        const link = document.createElement("a");
        link.className = "link";
        link.href = item.path;
        link.textContent = "Open file";
        link.target = "_blank";
        link.rel = "noopener noreferrer";

        const arrow = document.createElement("span");
        arrow.textContent = "‚Üó";
        link.appendChild(arrow);

        const filePath = document.createElement("span");
        filePath.className = "file-path";
        filePath.textContent = item.path;

        footer.appendChild(link);
        footer.appendChild(filePath);

        card.appendChild(header);
        if (item.description) card.appendChild(desc);
        card.appendChild(tagWrap);
        card.appendChild(footer);

        resultsGrid.appendChild(card);
      });

      const labelFilter =
        currentFilter === "all" ? "items"
        : currentFilter === "macro" ? "macros"
        : "processes";

      resultsCount.textContent = `${filtered.length} ${labelFilter} shown`;
    }

    searchInput.addEventListener("input", render);

    clearBtn.addEventListener("click", () => {
      searchInput.value = "";
      searchInput.focus();
      render();
    });

    filterButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        filterButtons.forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");
        currentFilter = btn.getAttribute("data-filter");
        render();
      });
    });

    async function init() {
      try {
        resultsCount.textContent = "Indexing‚Ä¶";
        const [macros, processes] = await Promise.all([
          fetchDir("macros", "macro"),
          fetchDir("processes", "process")
        ]);

        items = [...macros, ...processes];

        // nice consistent ordering
        items.sort((a,b) =>
          a.type === b.type ? a.title.localeCompare(b.title) : (a.type === "macro" ? -1 : 1)
        );

        setCounts();
        render();
      } catch (err) {
        console.warn(err);
        items = [];
        setCounts();
        resultsCount.textContent = "Couldn‚Äôt index files (GitHub API blocked/rate-limited). Refresh in a minute.";
        render();
      }
    }

    init();
  </script>
</body>
</html>
